<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Controle de Gastos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  </head>
  <body class="bg-light">
    <div id="app" class="container py-4">
      <h1 class="mb-4 text-center">Controle de Gastos</h1>

      <!-- Cadastro -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">Cadastrar Gasto</div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Categoria</label>
            <select
              v-model="category"
              class="form-select"
              @change="subcategory = ''"
            >
              <option disabled value="">Selecione</option>
              <option
                v-for="cat in Object.keys(categories)"
                :key="cat"
                :value="cat"
              >
                {{ cat }}
              </option>
            </select>
          </div>

          <div class="mb-3" v-if="category">
            <label class="form-label">Subcategoria</label>
            <select v-model="subcategory" class="form-select">
              <option disabled value="">Selecione</option>
              <option
                v-for="sub in categories[category]"
                :key="sub"
                :value="sub"
              >
                {{ sub }}
              </option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Valor</label>
            <input
              type="number"
              v-model.number="value"
              class="form-control"
              placeholder="R$"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Descrição (opcional)</label>
            <input type="text" v-model="desc" class="form-control" />
          </div>

          <button @click="addRecord" class="btn btn-success w-100">
            Adicionar
          </button>
        </div>
      </div>

      <!-- Registros -->
      <div class="card mb-4">
        <div class="card-header bg-secondary text-white">Registros</div>
        <ul class="list-group list-group-flush">
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
            v-for="(r, i) in records"
            :key="i"
          >
            <div>
              <strong>{{ r.category }} - {{ r.subcategory }}</strong><br />
              <small class="text-muted">{{ r.desc }}</small>
            </div>
            <span class="badge bg-primary rounded-pill"
              >R$ {{ r.value.toFixed(2) }}</span
            >
          </li>
        </ul>
      </div>

      <!-- Relatório -->
      <div class="card">
        <div class="card-header bg-dark text-white">
          Relatório por Categoria
        </div>
        <ul class="list-group list-group-flush">
          <li
            class="list-group-item d-flex justify-content-between"
            v-for="(val, cat) in totals"
            :key="cat"
          >
            <span>{{ cat }}</span>
            <span class="fw-bold text-success">R$ {{ val.toFixed(2) }}</span>
          </li>
        </ul>
      </div>
    </div>

    <script>
      const { createApp, reactive, ref, computed, watch } = Vue;

      createApp({
        setup() {
          const categories = reactive({
            Alimentação: ["Delivery", "Restaurantes", "Cafés / Padarias"],
            Lazer: ["Streaming", "Jogos / Apps", "Cinema / Eventos", "Vicios"],
            Compras: [
              "Vestuário",
              "Eletrônicos",
              "Farmácia",
              "Casa / Decoração",
            ],
            "Contas Fixas": [
              "Internet / Telefone",
              "Serviços Digitais",
              "Seguros",
            ],
            Transporte: ["Combustível", "Apps de Transporte", "Estacionamento"],
            Viagens: ["Passagens", "Hotéis", "Pacotes"],
            "Família & Presentes": ["Presentes", "Ajuda Familiar"],
            Financeiro: ["Parcelamentos", "Juros"],
          });

          const category = ref("");
          const subcategory = ref("");
          const value = ref(0);
          const desc = ref("");

          // Carregar do localStorage se existir
          const records = reactive(
            JSON.parse(localStorage.getItem("records")) || []
          );

          const addRecord = () => {
            if (!category.value || !subcategory.value || value.value === 0)
              return;
            records.push({
              category: category.value,
              subcategory: subcategory.value,
              value: Number(value.value),
              desc: desc.value,
            });
            // Atualizar localStorage
            localStorage.setItem("records", JSON.stringify(records));

            category.value = "";
            subcategory.value = "";
            value.value = 0;
            desc.value = "";
          };

          // Atualiza localStorage sempre que records mudar
          watch(
            records,
            (newRecords) => {
              localStorage.setItem("records", JSON.stringify(newRecords));
            },
            { deep: true }
          );

          const totals = computed(() => {
            return records.reduce((acc, r) => {
              acc[r.category] = (acc[r.category] || 0) + r.value;
              return acc;
            }, {});
          });

          return {
            categories,
            category,
            subcategory,
            value,
            desc,
            records,
            addRecord,
            totals,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
